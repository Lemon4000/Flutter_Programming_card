# 编程卡上位机 - 发布包

**版本**: v1.0.0
**日期**: 2026-01-21
**构建者**: Claude Sonnet 4.5

## 📦 包含内容

### Android 版本
- **文件**: `programming-card-host-v1.0.0-android.apk`
- **大小**: 47MB
- **平台**: Android 5.0+ (API 21+)

## 🚀 安装说明

### Android 设备安装

1. **启用未知来源安装**:
   - 打开"设置" → "安全" → 启用"未知来源"
   - 或在 Android 8.0+ 中，安装时会提示允许该来源

2. **传输 APK 文件**:
   - 通过 USB 数据线传输到设备
   - 或通过云存储/邮件发送到设备

3. **安装应用**:
   - 在文件管理器中找到 APK 文件
   - 点击文件开始安装
   - 按照提示完成安装

4. **授予权限**:
   - 首次运行时需要授予蓝牙权限
   - 授予位置权限（蓝牙扫描需要）
   - 授予存储权限（选择固件文件需要）

### Ubuntu/Linux 上运行 Android 应用

#### 方法 1: 使用 Waydroid (推荐)

```bash
# 安装 Waydroid
sudo apt install waydroid

# 初始化
waydroid init

# 启动会话
waydroid session start

# 安装 APK
waydroid app install programming-card-host-v1.0.0-android.apk

# 运行应用
waydroid app launch com.programmingcard.programming_card_host
```

#### 方法 2: 使用 Anbox

```bash
# 安装 Anbox
sudo snap install --devmode --beta anbox

# 安装 APK
adb install programming-card-host-v1.0.0-android.apk
```

## ✨ 功能特性

### 核心功能
- ✅ 蓝牙设备扫描和连接
- ✅ 参数读取和写入
- ✅ 固件烧录
- ✅ 通信日志查看

### 新增功能 (v1.0.0)
- ✅ **编程阶段重试延迟可配置** (10-500ms)
- ✅ **烧录中止状态修复** - 停止烧录后立即停止发送命令
- ✅ **UI 优化** - 烧录设置对话框改进

### 烧录设置
- **初始化超时**: 10-200ms (默认 50ms)
- **初始化重试**: 10-500次 (默认 100次)
- **编程重试延迟**: 10-500ms (默认 50ms) ⭐ 新增

## 📱 使用说明

### 1. 设备连接
1. 打开应用
2. 点击"设备"标签
3. 点击"扫描设备"按钮
4. 在列表中选择您的设备
5. 等待连接成功

### 2. 参数读写
1. 连接设备后，切换到"参数"标签
2. 选择参数组（A/B/C）
3. 点击"读取参数"查看当前值
4. 修改参数值
5. 点击"写入参数"保存更改

### 3. 固件烧录
1. 切换到"烧录"标签
2. 点击"从文件选择"按钮
3. 选择 HEX 固件文件
4. 调整烧录设置（可选）:
   - 点击设置区域的齿轮图标
   - 调整初始化超时、重试次数
   - **调整编程重试延迟** (新功能)
5. 点击"开始烧录"按钮
6. 等待烧录完成

### 4. 查看日志
1. 切换到"日志"标签
2. 查看实时通信日志
3. 使用筛选按钮过滤 TX/RX 数据
4. 点击"清除"按钮清空日志

## ⚙️ 烧录设置建议

### 编程重试延迟配置

| 场景 | 推荐延迟 | 说明 |
|------|---------|------|
| 稳定环境 | 50ms (默认) | 信号良好、设备响应快 |
| 信号不稳定 | 100-200ms | 增加延迟提高成功率 |
| 设备响应慢 | 200-300ms | 给设备更多处理时间 |
| 极端情况 | 300-500ms | 最大延迟，最稳定 |

### 调优建议
1. 从默认值 50ms 开始
2. 如果烧录失败，每次增加 50ms
3. 观察日志中的重试次数
4. 平衡速度和稳定性

## 🔧 故障排除

### 无法连接设备
- 确保蓝牙已开启
- 确保已授予位置权限
- 尝试重启蓝牙
- 检查设备是否已配对

### 烧录失败
- 检查固件文件是否正确
- 增加编程重试延迟
- 确保设备电量充足
- 尝试靠近设备减少干扰

### 参数读写失败
- 确保设备已连接
- 检查设备是否支持该参数组
- 尝试重新连接设备

## 📋 系统要求

### Android
- **最低版本**: Android 5.0 (API 21)
- **推荐版本**: Android 8.0+
- **权限需求**:
  - 蓝牙
  - 位置（用于蓝牙扫描）
  - 存储（用于选择文件）

### Ubuntu/Linux (使用 Waydroid)
- **系统**: Ubuntu 20.04+
- **内核**: 5.4+
- **依赖**: Waydroid 或 Anbox

## 📝 更新日志

### v1.0.0 (2026-01-21)

#### 新增功能
- ✨ 编程阶段重试延迟可配置 (10-500ms)
- ✨ 烧录设置对话框优化
- ✨ 紧凑显示格式

#### Bug 修复
- 🐛 修复烧录中止后仍发送命令的问题
- 🐛 添加状态转换保护机制
- 🐛 改进重试逻辑的状态检查

#### 改进
- 💄 UI 美化和动画效果
- 📝 完善的设计文档
- 🔧 代码质量提升

## 📄 许可证

本项目为内部使用版本。

## 🤝 技术支持

如有问题或建议，请联系开发团队。

## 📚 相关文档

- `LINUX_BUILD_GUIDE.md` - Linux 构建指南
- `docs/plans/2026-01-20-program-retry-delay-config.md` - 配置功能设计文档
- `docs/plans/2026-01-20-flash-abort-state-fix.md` - 中止问题修复文档

---

**构建信息**:
- 构建时间: 2026-01-21 08:14
- Flutter 版本: Stable
- Dart 版本: 3.x
- 构建模式: Release
