# è¿ç»­å‘é€åŒæ­¥ä¼ è¾“åŠŸèƒ½ - æœ€ç»ˆå®ç°

## âœ… å·²å®Œæˆ

æˆåŠŸå®ç°äº†è¿ç»­å‘é€ä¸å®é™…ä¼ è¾“åŒæ­¥çš„åŠŸèƒ½ï¼

## ğŸ”§ æ ¸å¿ƒæ”¹è¿›

### 1. æ–°å¢æ–¹æ³•ï¼š`sendDataFrameOnly()`

**ä½ç½®**ï¼š`lib/data/services/debug_service.dart`

```dart
/// åªå‘é€æ•°æ®å¸§ï¼Œä¸ç­‰å¾…å“åº”
Future<void> sendDataFrameOnly({
  required int address,
  required List<int> data,
}) async {
  // æ„å»ºæ•°æ®å¸§
  final frame = frameBuilder.buildFlashDataFrame(address, data);

  // å‘é€ï¼ˆç­‰å¾…å†™å…¥è“ç‰™ç¼“å†²åŒºå®Œæˆï¼‰âœ…
  await bluetoothDatasource.write(frame);
}
```

**å…³é”®ç‚¹**ï¼š
- ç­‰å¾…æ•°æ®å†™å…¥è“ç‰™ç¼“å†²åŒº
- ä¸ç­‰å¾…è®¾å¤‡å“åº”
- ç¡®ä¿å‘é€é—´éš”å‡†ç¡®

### 2. è¿ç»­å‘é€å®ç°

**ä½ç½®**ï¼š`lib/presentation/screens/debug_screen.dart`

```dart
Future<void> _sendAllDataFrames() async {
  for (int i = startIndex; i < dataBlocks.length; i++) {
    // åªå‘é€æ•°æ®ï¼Œç­‰å¾…å†™å…¥å®Œæˆï¼ˆä¸ç­‰å¾…å“åº”ï¼‰âœ…
    await debugService.sendDataFrameOnly(
      address: block.address,
      data: block.data,
    );

    // ç­‰å¾…å‘é€é—´éš” âœ…
    await Future.delayed(Duration(milliseconds: sendInterval));
  }
}
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `await` ç­‰å¾…å†™å…¥å®Œæˆ
- ç„¶åç­‰å¾…å‘é€é—´éš”
- ç¡®ä¿UIä¸å®é™…ä¼ è¾“åŒæ­¥

## ğŸ“Š å·¥ä½œæµç¨‹å¯¹æ¯”

### ä¹‹å‰ï¼ˆä¸åŒæ­¥ï¼‰âŒ

```
è°ƒç”¨ sendDataFrame() â†’ ä¸ç­‰å¾… â†’ ç­‰å¾…é—´éš” â†’ ä¸‹ä¸€ä¸ª
    â†“
æ‰€æœ‰è¯·æ±‚å¿«é€Ÿè¿›å…¥è“ç‰™ç¼“å†²åŒº
    â†“
è“ç‰™æ…¢æ…¢ä¼ è¾“ï¼ˆUIå·²æ˜¾ç¤ºå®Œæˆï¼‰âŒ
```

**é—®é¢˜**ï¼š
- UIæ˜¾ç¤ºå®Œæˆï¼Œä½†æ•°æ®è¿˜åœ¨ä¼ è¾“
- å‘é€é—´éš”æ— å®é™…æ„ä¹‰
- ä¸²å£æ¥æ”¶æ»å

### ç°åœ¨ï¼ˆåŒæ­¥ï¼‰âœ…

```
è°ƒç”¨ sendDataFrameOnly()
    â†“
ç­‰å¾…æ•°æ®å†™å…¥è“ç‰™ç¼“å†²åŒº âœ…
    â†“
ç­‰å¾…å‘é€é—´éš” âœ…
    â†“
ä¸‹ä¸€ä¸ª
```

**ä¼˜åŠ¿**ï¼š
- UIæ˜¾ç¤ºä¸å®é™…ä¼ è¾“åŒæ­¥
- å‘é€é—´éš”å‡†ç¡®æ§åˆ¶é€Ÿåº¦
- ä¸²å£æ¥æ”¶ä¸UIä¸€è‡´

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. è¿ç»­å‘é€å…¨éƒ¨æŒ‰é’®

- ä½ç½®ï¼šæ•°æ®å¸§å¡ç‰‡åº•éƒ¨
- æ–‡æœ¬ï¼š`è¿ç»­å‘é€å…¨éƒ¨ (N å—)`
- é¢œè‰²ï¼šç»¿è‰²
- åŠŸèƒ½ï¼šç‚¹å‡»ä¸€æ¬¡è‡ªåŠ¨å‘é€æ‰€æœ‰æ•°æ®å—

### 2. åœæ­¢æŒ‰é’®

- æ˜¾ç¤ºï¼šå‘é€è¿‡ç¨‹ä¸­å‡ºç°
- æ–‡æœ¬ï¼š`åœæ­¢`
- é¢œè‰²ï¼šçº¢è‰²
- åŠŸèƒ½ï¼šç«‹å³åœæ­¢è¿ç»­å‘é€

### 3. å‘é€é—´éš”æ§åˆ¶

- èŒƒå›´ï¼š10-1000ms
- é»˜è®¤ï¼š100ms
- æ¨èï¼š100-200ms
- ä½œç”¨ï¼šå‡†ç¡®æ§åˆ¶ä¼ è¾“é€Ÿåº¦

### 4. å®æ—¶è¿›åº¦

- å—ç´¢å¼•è‡ªåŠ¨æ›´æ–°
- æ—¥å¿—å®æ—¶è®°å½•
- è¿›åº¦å¯è§†åŒ–

## ğŸ§ª æµ‹è¯•æ­¥éª¤

1. **è¿è¡Œåº”ç”¨**ï¼š
   ```bash
   ./run-linux.sh
   ```

2. **è¿æ¥è®¾å¤‡**

3. **è¿›å…¥è°ƒè¯•é¡µé¢**

4. **åŠ è½½ HEX æ–‡ä»¶**

5. **è®¾ç½®å‘é€é—´éš”**ï¼ˆå¦‚ 100msï¼‰

6. **ç‚¹å‡»"è¿ç»­å‘é€å…¨éƒ¨"**

7. **è§‚å¯Ÿ**ï¼š
   - UIè¿›åº¦æ›´æ–°
   - ä¸²å£æ¥æ”¶æ•°æ®
   - ä¸¤è€…åº”è¯¥åŒæ­¥ âœ…

8. **éªŒè¯åŒæ­¥**ï¼š
   - UIæ˜¾ç¤ºå‘é€å®Œæˆæ—¶
   - ä¸²å£ä¹Ÿåº”è¯¥æ¥æ”¶å®Œæˆ
   - ä¸ä¼šå‡ºç°æ»å

## âœ… é¢„æœŸç»“æœ

### UIæ˜¾ç¤º

```
[14:30:00.100] å‘é€æ•°æ®å¸§: å— 0/99, åœ°å€ 0x00001000
[14:30:00.200] å‘é€æ•°æ®å¸§: å— 1/99, åœ°å€ 0x00001100
[14:30:00.300] å‘é€æ•°æ®å¸§: å— 2/99, åœ°å€ 0x00001200
...
[14:30:10.000] è¿ç»­å‘é€å®Œæˆ âœ…
```

### ä¸²å£æ¥æ”¶

```
æ¥æ”¶: å— 0 æ•°æ®...
æ¥æ”¶: å— 1 æ•°æ®...
æ¥æ”¶: å— 2 æ•°æ®...
...
æ¥æ”¶å®Œæˆ âœ…ï¼ˆä¸UIåŒæ—¶ï¼‰
```

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### å‘é€ 100 ä¸ªæ•°æ®å—ï¼ˆæ¯å— 256 å­—èŠ‚ï¼‰

| å‘é€é—´éš” | æ€»æ—¶é—´ | é€Ÿåº¦ | åŒæ­¥æ€§ |
|---------|--------|------|--------|
| 50ms | ~5ç§’ | 20å—/ç§’ | âœ… åŒæ­¥ |
| 100ms | ~10ç§’ | 10å—/ç§’ | âœ… åŒæ­¥ |
| 200ms | ~20ç§’ | 5å—/ç§’ | âœ… åŒæ­¥ |

**å…³é”®æ”¹è¿›**ï¼š
- âœ… UIä¸ä¸²å£æ¥æ”¶å®Œå…¨åŒæ­¥
- âœ… å‘é€é—´éš”å‡†ç¡®æ§åˆ¶é€Ÿåº¦
- âœ… ä¸ä¼šå‡ºç°UIå®Œæˆä½†æ•°æ®è¿˜åœ¨ä¼ è¾“

## âš™ï¸ æŠ€æœ¯ç»†èŠ‚

### 1. ä¸ºä»€ä¹ˆè¦ç­‰å¾…å†™å…¥ï¼Ÿ

```dart
await bluetoothDatasource.write(frame);
```

- ç¡®ä¿æ•°æ®è¿›å…¥è“ç‰™ç¼“å†²åŒº
- é¿å…ç¼“å†²åŒºæº¢å‡º
- ä¿è¯å‘é€é—´éš”å‡†ç¡®

### 2. ä¸ºä»€ä¹ˆä¸ç­‰å¾…å“åº”ï¼Ÿ

- å“åº”éœ€è¦è®¾å¤‡å¤„ç†æ—¶é—´ï¼ˆå¯èƒ½å‡ ç™¾æ¯«ç§’ï¼‰
- æˆ‘ä»¬åªå…³å¿ƒæ•°æ®å‘é€ï¼Œä¸å…³å¿ƒå“åº”
- å“åº”å¯ä»¥å¼‚æ­¥å¤„ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰

### 3. å‘é€é—´éš”çš„ä½œç”¨

- æ§åˆ¶è“ç‰™ä¼ è¾“é€Ÿç‡
- ç»™è®¾å¤‡å¤„ç†æ—¶é—´
- é¿å…ç¼“å†²åŒºå‹åŠ›

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå‘é€é€Ÿåº¦å¤ªæ…¢

**è§£å†³**ï¼šå‡å°å‘é€é—´éš”
- ä» 100ms å‡åˆ° 50ms
- è§‚å¯Ÿè®¾å¤‡æ˜¯å¦èƒ½å¤„ç†

### é—®é¢˜2ï¼šè®¾å¤‡å¤„ç†ä¸è¿‡æ¥

**è§£å†³**ï¼šå¢åŠ å‘é€é—´éš”
- ä» 100ms å¢åˆ° 200ms
- ç»™è®¾å¤‡æ›´å¤šå¤„ç†æ—¶é—´

### é—®é¢˜3ï¼šä»ç„¶ä¸åŒæ­¥

**æ£€æŸ¥**ï¼š
- ç¡®è®¤ä½¿ç”¨çš„æ˜¯æ–°æ„å»ºçš„ç‰ˆæœ¬
- æ£€æŸ¥å‘é€é—´éš”è®¾ç½®
- æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ä½¿ç”¨äº† `sendDataFrameOnly`

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `lib/data/services/debug_service.dart`
   - æ·»åŠ  `sendDataFrameOnly()` æ–¹æ³•
   - æ·»åŠ  `dart:async` å¯¼å…¥

2. âœ… `lib/presentation/screens/debug_screen.dart`
   - æ·»åŠ è¿ç»­å‘é€æŒ‰é’®UI
   - æ·»åŠ åœæ­¢æŒ‰é’®UI
   - å®ç° `_sendAllDataFrames()` æ–¹æ³•
   - å®ç° `_stopContinuousSending()` æ–¹æ³•

3. âœ… `lib/presentation/providers/debug_providers.dart`
   - å·²æœ‰ `isContinuousSendingProvider`
   - å·²æœ‰ `sendIntervalProvider`

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†è¿ç»­å‘é€ä¸å®é™…ä¼ è¾“çš„å®Œå…¨åŒæ­¥ï¼

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. ç­‰å¾…æ•°æ®å†™å…¥è“ç‰™ç¼“å†²åŒº
2. ç„¶åç­‰å¾…å‘é€é—´éš”
3. ç¡®ä¿UIæ˜¾ç¤ºä¸å®é™…ä¼ è¾“ä¸€è‡´

**ç”¨æˆ·ä½“éªŒ**ï¼š
- âœ… UIè¿›åº¦å‡†ç¡®åæ˜ å®é™…ä¼ è¾“
- âœ… å‘é€é—´éš”çœŸæ­£æ§åˆ¶é€Ÿåº¦
- âœ… ä¸²å£æ¥æ”¶ä¸UIå®Œå…¨åŒæ­¥
- âœ… ä¸ä¼šå‡ºç°UIå®Œæˆä½†æ•°æ®è¿˜åœ¨ä¼ è¾“

ç°åœ¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨è¿ç»­å‘é€åŠŸèƒ½ï¼ŒUIæ˜¾ç¤ºçš„è¿›åº¦å°±æ˜¯å®é™…çš„ä¼ è¾“è¿›åº¦ï¼
