# æ—¥å¿—æ˜¾ç¤ºä¼˜åŒ– - æ•°æ®çœç•¥å’Œé¢‘ç‡è®¡ç®—

## ğŸ¯ æ”¹è¿›ç›®æ ‡

1. **çœç•¥ DATA éƒ¨åˆ†**: æ•°æ®å¸§ä¸­çš„å¤§æ®µæ•°æ®çœç•¥æ˜¾ç¤ºï¼Œä½†ä¿ç•™ `;CRC` éƒ¨åˆ†
2. **æ˜¾ç¤ºé¢‘ç‡**: è®¡ç®—å¹¶æ˜¾ç¤ºç›¸åŒæ•°æ®çš„å‘é€/æ¥æ”¶é¢‘ç‡

---

## ğŸ“Š æ”¹è¿›æ•ˆæœ

### æ•°æ®æ˜¾ç¤ºä¼˜åŒ–

#### ASCII æ¨¡å¼

**æ”¹è¿›å‰**ï¼ˆå®Œæ•´æ˜¾ç¤ºï¼Œå¤ªé•¿ï¼‰:
```
!HEX:START0200,SIZE256,DATA21484558...ï¼ˆ256å­—èŠ‚æ•°æ®ï¼‰...3B43524331323334;
```

**æ”¹è¿›å**ï¼ˆæ™ºèƒ½çœç•¥ï¼‰:
```
!HEX:START0200,SIZE256,DATA...[çœç•¥ 256 å­—èŠ‚];CRC1234
```

#### HEX æ¨¡å¼

**æ”¹è¿›å‰**ï¼ˆå®Œæ•´æ˜¾ç¤ºï¼Œå¤ªé•¿ï¼‰:
```
21 48 45 58 3A 53 54 41 52 54 ... (256å­—èŠ‚) ... 3B 43 52 43
```

**æ”¹è¿›å**ï¼ˆæ™ºèƒ½çœç•¥ï¼‰:
```
21 48 45 58 3A 53 54 41 52 54 ... [çœç•¥ 256 å­—èŠ‚] ... 3B 43 52 43
```

### é¢‘ç‡æ˜¾ç¤º

**æ˜¾ç¤ºæ•ˆæœ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [TX] [x256] æœ€å: 10:00:20.00  [256 B]         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸš€ é¢‘ç‡: 12.8/s                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ !HEX:START0200,SIZE256,DATA...[çœç•¥ 256]   â”‚ â”‚
â”‚ â”‚ ;CRC1234                                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. æ·»åŠ é¦–æ¬¡æ—¶é—´æˆ³

**æ–‡ä»¶**: `lib/presentation/screens/log_screen.dart`

```dart
class LogEntry {
  final DateTime timestamp;      // æœ€åä¸€æ¬¡æ—¶é—´
  final DateTime firstTimestamp; // é¦–æ¬¡æ—¶é—´ï¼ˆæ–°å¢ï¼‰
  final String direction;
  final List<int> data;
  final int count;

  LogEntry({
    required this.timestamp,
    DateTime? firstTimestamp,
    required this.direction,
    required this.data,
    this.count = 1,
  }) : firstTimestamp = firstTimestamp ?? timestamp;
}
```

### 2. è®¡ç®—é¢‘ç‡

```dart
/// è®¡ç®—é¢‘ç‡ï¼ˆæ¬¡/ç§’ï¼‰
double get frequency {
  if (count <= 1) return 0.0;

  final duration = timestamp.difference(firstTimestamp);
  if (duration.inMilliseconds == 0) return 0.0;

  // é¢‘ç‡ = (è®¡æ•° - 1) / æ—¶é—´å·®ï¼ˆç§’ï¼‰
  return (count - 1) / (duration.inMilliseconds / 1000.0);
}

/// æ ¼å¼åŒ–é¢‘ç‡
String get formattedFrequency {
  if (frequency == 0.0) return '-';
  if (frequency >= 1000) {
    return '${(frequency / 1000).toStringAsFixed(1)}k/s';  // åƒæ¬¡/ç§’
  }
  return '${frequency.toStringAsFixed(1)}/s';  // æ¬¡/ç§’
}
```

### 3. æ™ºèƒ½çœç•¥æ˜¾ç¤º

```dart
/// è½¬æ¢ä¸ºASCIIæ ¼å¼ï¼ˆæ™ºèƒ½çœç•¥ï¼‰
String toAsciiSmart() {
  final fullStr = toAscii();

  // æ£€æŸ¥æ˜¯å¦åŒ…å« DATA å…³é”®å­—
  if (fullStr.contains('DATA')) {
    // æŸ¥æ‰¾ DATA çš„ä½ç½®
    final dataIndex = fullStr.indexOf('DATA');

    // æŸ¥æ‰¾åé¢çš„åˆ†å·ä½ç½®
    final semicolonIndex = fullStr.indexOf(';', dataIndex);

    if (semicolonIndex != -1) {
      // æå– DATA ä¹‹å‰çš„éƒ¨åˆ†
      final beforeData = fullStr.substring(0, dataIndex + 4); // åŒ…å« "DATA"

      // æå–åˆ†å·åŠä¹‹åçš„éƒ¨åˆ†ï¼ˆåŒ…å« CRCï¼‰
      final afterData = fullStr.substring(semicolonIndex);

      // è®¡ç®—çœç•¥çš„å­—ç¬¦æ•°
      final omittedLength = semicolonIndex - (dataIndex + 4);

      // è¿”å›çœç•¥æ ¼å¼
      return '$beforeData...[çœç•¥ $omittedLength å­—èŠ‚]$afterData';
    }
  }

  // å¦‚æœä¸åŒ…å« DATA æˆ–æ ¼å¼ä¸åŒ¹é…ï¼Œè¿”å›åŸå§‹å­—ç¬¦ä¸²
  return fullStr;
}
```

### 4. UI æ˜¾ç¤º

```dart
// é¢‘ç‡æ˜¾ç¤ºï¼ˆå¦‚æœè®¡æ•° > 1ï¼‰
if (log.count > 1)
  Container(
    padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 6),
    decoration: BoxDecoration(
      gradient: LinearGradient(
        colors: [
          Colors.purple.shade50,
          Colors.purple.shade100,
        ],
      ),
      borderRadius: BorderRadius.circular(8),
    ),
    child: Row(
      children: [
        Icon(Icons.speed_rounded, size: 14, color: Colors.purple.shade700),
        const SizedBox(width: 6),
        Text(
          'é¢‘ç‡: ${log.formattedFrequency}',
          style: TextStyle(
            fontFamily: 'monospace',
            fontSize: 12,
            fontWeight: FontWeight.bold,
            color: Colors.purple.shade700,
          ),
        ),
      ],
    ),
  ),

// æ•°æ®å†…å®¹ï¼ˆä½¿ç”¨æ™ºèƒ½çœç•¥ï¼‰
SelectableText(
  log.toAsciiSmart(),  // æ™ºèƒ½çœç•¥ DATA éƒ¨åˆ†
  style: TextStyle(...),
)
```

---

## ğŸ’¡ å·¥ä½œåŸç†

### é¢‘ç‡è®¡ç®—å…¬å¼

```
é¢‘ç‡ = (æ€»æ¬¡æ•° - 1) / (æœ€åæ—¶é—´ - é¦–æ¬¡æ—¶é—´)

ç¤ºä¾‹:
- é¦–æ¬¡æ—¶é—´: 10:00:00.000
- æœ€åæ—¶é—´: 10:00:20.000
- æ€»æ¬¡æ•°: 256

é¢‘ç‡ = (256 - 1) / 20 = 12.75 æ¬¡/ç§’
```

### æ•°æ®çœç•¥é€»è¾‘

```
åŸå§‹æ•°æ®:
!HEX:START0200,SIZE256,DATA[256å­—èŠ‚äºŒè¿›åˆ¶æ•°æ®];CRC1234

å¤„ç†æµç¨‹:
1. æŸ¥æ‰¾ "DATA" ä½ç½® â†’ ç´¢å¼• 24
2. æŸ¥æ‰¾åé¢çš„ ";" ä½ç½® â†’ ç´¢å¼• 280
3. æå–å‰ç¼€: "!HEX:START0200,SIZE256,DATA"
4. æå–åç¼€: ";CRC1234"
5. è®¡ç®—çœç•¥é•¿åº¦: 280 - 28 = 252 å­—èŠ‚
6. ç»„åˆç»“æœ: "å‰ç¼€...[çœç•¥ 252 å­—èŠ‚]åç¼€"
```

---

## ğŸ¨ è§†è§‰è®¾è®¡

### é¢‘ç‡å¾½ç« 
- **é¢œè‰²**: ç´«è‰²æ¸å˜ï¼ˆåŒºåˆ«äºè®¡æ•°çš„æ©™è‰²ï¼‰
- **å›¾æ ‡**: `speed_rounded`ï¼ˆé€Ÿåº¦è¡¨ï¼‰
- **ä½ç½®**: åœ¨æ•°æ®å†…å®¹ä¸Šæ–¹
- **æ ¼å¼**:
  - `12.8/s` - æ¯ç§’æ¬¡æ•°
  - `1.2k/s` - åƒæ¬¡/ç§’ï¼ˆâ‰¥1000æ—¶ï¼‰

### æ•°æ®çœç•¥
- **æ ¼å¼**: `DATA...[çœç•¥ N å­—èŠ‚];CRC`
- **ä¿ç•™**: å‘½ä»¤å¤´éƒ¨å’Œ CRC å°¾éƒ¨
- **çœç•¥**: ä¸­é—´çš„å¤§æ®µäºŒè¿›åˆ¶æ•°æ®
- **å¥½å¤„**:
  - å‡å°‘æ˜¾ç¤ºç©ºé—´
  - ä¿ç•™å…³é”®ä¿¡æ¯
  - æé«˜å¯è¯»æ€§

---

## ğŸ“‹ æ˜¾ç¤ºç¤ºä¾‹

### åˆå§‹åŒ–é˜¶æ®µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [TX] [x100] æœ€å: 10:00:05.00          â”‚
â”‚ ğŸš€ é¢‘ç‡: 20.0/s                         â”‚
â”‚ !HEX;                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼–ç¨‹é˜¶æ®µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [TX] [x256] æœ€å: 10:00:20.00          â”‚
â”‚ ğŸš€ é¢‘ç‡: 12.8/s                         â”‚
â”‚ !HEX:START0200,SIZE256,DATA...          â”‚
â”‚ [çœç•¥ 256 å­—èŠ‚];CRC1234                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [RX] [x256] æœ€å: 10:00:20.05          â”‚
â”‚ ğŸš€ é¢‘ç‡: 12.8/s                         â”‚
â”‚ #HEX:REPLY[CRC3];                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éªŒè¯é˜¶æ®µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [TX] [x1] 10:00:20.10                   â”‚
â”‚ !HEX:ENDCRC1234;                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: å¿«é€Ÿå‘é€ï¼ˆé«˜é¢‘ç‡ï¼‰

**æ“ä½œ**: åˆå§‹åŒ–é˜¶æ®µï¼Œå¿«é€Ÿå‘é€ 100 æ¬¡ `!HEX;`

**é¢„æœŸ**:
- è®¡æ•°: `[x100]`
- é¢‘ç‡: `20.0/s` æˆ–æ›´é«˜
- æ•°æ®: `!HEX;`ï¼ˆæ— çœç•¥ï¼‰

### åœºæ™¯ 2: æ…¢é€Ÿå‘é€ï¼ˆä½é¢‘ç‡ï¼‰

**æ“ä½œ**: æ‰‹åŠ¨æµ‹è¯•ï¼Œé—´éš” 1 ç§’å‘é€

**é¢„æœŸ**:
- è®¡æ•°: `[x10]`
- é¢‘ç‡: `1.0/s`
- æ•°æ®: æ­£å¸¸æ˜¾ç¤º

### åœºæ™¯ 3: æ•°æ®å¸§çœç•¥

**æ“ä½œ**: ç¼–ç¨‹é˜¶æ®µï¼Œå‘é€ 256 ä¸ªæ•°æ®å—

**é¢„æœŸ**:
- è®¡æ•°: `[x256]`
- é¢‘ç‡: `12.8/s`ï¼ˆå‡è®¾ 20 ç§’å®Œæˆï¼‰
- æ•°æ®: `!HEX:START...,DATA...[çœç•¥ 256 å­—èŠ‚];CRC...`

### åœºæ™¯ 4: å•æ¬¡å‘é€ï¼ˆæ— é¢‘ç‡ï¼‰

**æ“ä½œ**: å‘é€å•ä¸ªå‘½ä»¤

**é¢„æœŸ**:
- è®¡æ•°: `[x1]`ï¼ˆä¸æ˜¾ç¤ºå¾½ç« ï¼‰
- é¢‘ç‡: ä¸æ˜¾ç¤º
- æ•°æ®: å®Œæ•´æ˜¾ç¤º

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### é¢‘ç‡è®¡ç®—
- **æ—¶é—´å¤æ‚åº¦**: O(1)
- **ç©ºé—´å¤æ‚åº¦**: O(1)
- **è®¡ç®—æ—¶æœº**: åªåœ¨æ˜¾ç¤ºæ—¶è®¡ç®—ï¼Œä¸å½±å“æ—¥å¿—è®°å½•æ€§èƒ½

### æ•°æ®çœç•¥
- **æ—¶é—´å¤æ‚åº¦**: O(n)ï¼Œn ä¸ºå­—ç¬¦ä¸²é•¿åº¦
- **ä¼˜åŒ–**: åªåœ¨ ASCII æ¨¡å¼ä¸‹çœç•¥ï¼ŒHEX æ¨¡å¼ä¿æŒåŸæ ·
- **ç¼“å­˜**: å¯ä»¥è€ƒè™‘ç¼“å­˜çœç•¥åçš„å­—ç¬¦ä¸²

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æŸ¥çœ‹é¢‘ç‡
1. **é«˜é¢‘ç‡** (>10/s): é€šå¸¸æ˜¯åˆå§‹åŒ–æˆ–ç¼–ç¨‹é˜¶æ®µ
2. **ä¸­é¢‘ç‡** (1-10/s): æ­£å¸¸é€šä¿¡
3. **ä½é¢‘ç‡** (<1/s): æ…¢é€Ÿæ“ä½œæˆ–æ‰‹åŠ¨æµ‹è¯•

### æ•°æ®æ˜¾ç¤ºæ¨¡å¼
- **HEX æ¨¡å¼**: æŸ¥çœ‹åŸå§‹å­—èŠ‚ï¼Œä¸çœç•¥
- **ASCII æ¨¡å¼**: æ™ºèƒ½çœç•¥ï¼Œæ˜“è¯»
- **æ··åˆæ¨¡å¼**: ä¸¤è€…éƒ½æ˜¾ç¤º

### æ€§èƒ½ç›‘æ§
é€šè¿‡é¢‘ç‡å¯ä»¥ç›‘æ§é€šä¿¡æ€§èƒ½ï¼š
- é¢‘ç‡çªç„¶ä¸‹é™ â†’ å¯èƒ½æœ‰é€šä¿¡é—®é¢˜
- é¢‘ç‡å¼‚å¸¸é«˜ â†’ å¯èƒ½æœ‰é‡è¯•æˆ–é”™è¯¯
- é¢‘ç‡ç¨³å®š â†’ é€šä¿¡æ­£å¸¸

---

## ğŸ”„ æœªæ¥æ”¹è¿›

### 1. å¯é…ç½®çœç•¥
```dart
// å…è®¸ç”¨æˆ·é…ç½®çœç•¥é˜ˆå€¼
final omitThreshold = 100;  // è¶…è¿‡ 100 å­—èŠ‚æ‰çœç•¥
```

### 2. æ›´å¤šç»Ÿè®¡ä¿¡æ¯
```dart
// å¹³å‡é¢‘ç‡
double get averageFrequency;

// å³°å€¼é¢‘ç‡
double get peakFrequency;

// æ€»å­—èŠ‚æ•°
int get totalBytes;
```

### 3. é¢‘ç‡å›¾è¡¨
```dart
// æ˜¾ç¤ºé¢‘ç‡å˜åŒ–æ›²çº¿
Widget buildFrequencyChart();
```

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### 1. æ—¶é—´æˆ³ç®¡ç†
```dart
// é¦–æ¬¡æ—¶é—´æˆ³åœ¨åˆ›å»ºæ—¶è®¾ç½®
LogEntry({
  required this.timestamp,
  DateTime? firstTimestamp,
  ...
}) : firstTimestamp = firstTimestamp ?? timestamp;

// æ›´æ–°æ—¶ä¿æŒé¦–æ¬¡æ—¶é—´æˆ³ä¸å˜
LogEntry copyWith({
  DateTime? timestamp,
  int? count,
}) {
  return LogEntry(
    timestamp: timestamp ?? this.timestamp,
    firstTimestamp: firstTimestamp,  // ä¸å˜
    ...
  );
}
```

### 2. å­—ç¬¦ä¸²å¤„ç†
```dart
// ä½¿ç”¨ substring æå–éƒ¨åˆ†
final beforeData = fullStr.substring(0, dataIndex + 4);
final afterData = fullStr.substring(semicolonIndex);

// ç»„åˆç»“æœ
return '$beforeData...[çœç•¥ $omittedLength å­—èŠ‚]$afterData';
```

### 3. æ¡ä»¶æ˜¾ç¤º
```dart
// åªåœ¨è®¡æ•° > 1 æ—¶æ˜¾ç¤ºé¢‘ç‡
if (log.count > 1)
  FrequencyWidget(frequency: log.formattedFrequency);
```

---

**å®ç°æ—¶é—´**: 2026-01-23
**ç‰ˆæœ¬**: 2.0
**çŠ¶æ€**: å·²å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: å¾…è®¾å¤‡éªŒè¯
