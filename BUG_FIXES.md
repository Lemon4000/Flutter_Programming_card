# Bug 修复清单

## 待修复的问题

### 1. Android 设备重连后黑屏问题 ⚠️ 严重

**问题描述**：
- Android 设备连接中断后再次连接
- 蓝牙连接成功，但应用界面黑屏
- 无法恢复，必须重启应用

**可能原因**：
- 连接状态监听器重复订阅
- 状态管理冲突
- 导航栈问题

**修复计划**：
1. 检查连接状态监听器的生命周期
2. 确保重连时正确清理旧的订阅
3. 添加状态重置逻辑

---

### 2. 连接后显示"设备连接已断开" ⚠️ 中等

**问题描述**：
- 每个平台连接设备后
- 刚开始会显示"设备连接已断开"的提示

**可能原因**：
- 连接状态流初始值为 `disconnected`
- 监听器在连接完成前就触发了

**修复计划**：
1. 延迟设置连接状态监听器
2. 过滤初始的 disconnected 状态
3. 只在真正断开时显示提示

---

### 3. 烧录无法停止 ⚠️ 严重

**问题描述**：
- 烧录过程中点击"停止烧录"无效
- 命令继续发送
- 重新烧录时 UI 显示从头开始，但实际在之前的命令重试

**可能原因**：
- 取消标志未正确传递
- Worker 线程未响应取消请求
- 状态未正确重置

**修复计划**：
1. 检查 FlashWorker 的取消逻辑
2. 确保取消标志正确传递
3. 添加强制停止机制
4. 重置烧录状态

---

### 4. 参数界面不保存之前的值 ⚠️ 中等

**问题描述**：
- 每次进入参数界面都显示默认参数
- 不会显示之前读取或修改的值

**可能原因**：
- 参数状态未持久化
- Provider 每次重建
- 状态管理问题

**修复计划**：
1. 使用 StateNotifierProvider 保存参数状态
2. 读取参数后更新状态
3. 界面显示保存的状态

---

### 5. 参数修改无差异性显示 ⚠️ 低

**问题描述**：
- 读取参数后修改值
- UI 上看不出哪些数据被修改了
- 缺少视觉反馈

**修复计划**：
1. 保存原始读取的参数值
2. 比较当前值和原始值
3. 修改过的参数用不同颜色/图标标识
4. 添加"恢复默认"按钮

---

## 修复优先级

1. **高优先级**（严重影响使用）：
   - ✅ Android 重连黑屏
   - ✅ 烧录无法停止

2. **中优先级**（影响体验）：
   - ✅ 连接后误报断开
   - ✅ 参数不保存

3. **低优先级**（改进体验）：
   - ✅ 参数差异显示

---

## 修复进度

- [ ] 问题 1: Android 重连黑屏
- [ ] 问题 2: 连接后误报断开
- [ ] 问题 3: 烧录无法停止
- [ ] 问题 4: 参数不保存
- [ ] 问题 5: 参数差异显示

---

**创建时间**: 2026-01-23
**状态**: 待修复
