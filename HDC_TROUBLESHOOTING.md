# é¸¿è’™è®¾å¤‡è¿æ¥é—®é¢˜è§£å†³æ–¹æ¡ˆæ€»ç»“

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

**åŸå§‹é—®é¢˜**ï¼š
- Linuxç³»ç»Ÿæ— æ³•è¯†åˆ«é¸¿è’™è®¾å¤‡ç”¨äºFlutterå¼€å‘
- é”™è¯¯ä¿¡æ¯ï¼š"bad state no element"
- `flutter devices` æ— æ³•æ‰¾åˆ°è®¾å¤‡

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ç³»ç»ŸåŒ–è°ƒè¯•åˆ†æ

é€šè¿‡systematic-debuggingæ–¹æ³•ï¼Œæˆ‘ä»¬è¯†åˆ«äº†æ ¹æœ¬åŸå› ï¼š

- **è®¾å¤‡è¿æ¥çŠ¶æ€**ï¼šâœ… è®¾å¤‡å·²é€šè¿‡USBè¿æ¥
  ```
  Bus 003 Device 039: ID 12d1:1101 Huawei Technologies Co., Ltd. HDC Device
  ```

- **åè®®ä¸åŒ¹é…**ï¼šè®¾å¤‡ä½¿ç”¨HDCåè®®ï¼Œè€ŒFlutteréœ€è¦ADBåè®®

### 2. HDCå·¥å…·å®‰è£…

æˆåŠŸå®‰è£…äº†HarmonyOSå¼€å‘å·¥å…·ï¼š

- âœ… ä¸‹è½½å¹¶å®‰è£… `commandline-tools-linux-2.0.0.2.zip`
- âœ… å®‰è£… HarmonyOS toolchains (3.2.3.6)
- âœ… å®‰è£… OpenHarmony toolchains (3.2.12.5)
- âœ… é…ç½®ç¯å¢ƒå˜é‡åˆ° `~/.bashrc`
- âœ… æˆåŠŸè¯†åˆ«è®¾å¤‡ï¼š`33Z0224620027607`

**å®‰è£…è·¯å¾„**ï¼š
- HarmonyOS: `~/harmonyos-tools/hwsdk/hmscore/3.1.0/toolchains/`
- OpenHarmony: `~/harmonyos-tools/hwsdk/openharmony/9/toolchains/`

### 3. åˆ›å»ºçš„æ–‡æ¡£

- `install_hdc.sh` - HDCè‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬
- `HDC_USAGE_GUIDE.md` - HDCå·¥å…·ä½¿ç”¨æŒ‡å—
- `enable_adb_on_harmonyos.md` - ADBæ¨¡å¼å¯ç”¨æŒ‡å—
- `HDC_TROUBLESHOOTING.md` - æœ¬æ–‡æ¡£

## âš ï¸ å½“å‰çŠ¶æ€

### HDCå·¥å…·çŠ¶æ€

- **ç‰ˆæœ¬**: 1.2.0a
- **è®¾å¤‡è¯†åˆ«**: âœ… æˆåŠŸ
- **åŸºæœ¬åŠŸèƒ½**: âœ… å¯ç”¨ï¼ˆlist targets, file transfer, installï¼‰
- **Shellè®¿é—®**: âŒ å—é™ï¼ˆç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼‰

### ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

è¿è¡Œ `hdc shell` æ—¶å‡ºç°é”™è¯¯ï¼š
```
[Fail][E000001]:The sdk hdc.exe version is too low, please upgrade to the latest version.
```

**åŸå› åˆ†æ**ï¼š
1. æ‚¨çš„è®¾å¤‡è¿è¡Œ **HarmonyOS NEXT**ï¼ˆ5.0+ï¼‰ï¼Œè¿™æ˜¯çº¯é¸¿è’™ç³»ç»Ÿ
2. è®¾å¤‡ä¸Šçš„HDCæœåŠ¡ç‰ˆæœ¬æ¯”SDKä¸­çš„HDCå®¢æˆ·ç«¯ç‰ˆæœ¬æ›´æ–°
3. è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä¸å½±å“å¤§éƒ¨åˆ†åŠŸèƒ½

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šå¯ç”¨ADBæ¨¡å¼ï¼ˆå¼ºçƒˆæ¨èç”¨äºFlutterå¼€å‘ï¼‰

è¿™æ˜¯ä½¿ç”¨Flutterå¼€å‘çš„æœ€ä½³æ–¹æ¡ˆã€‚

#### æ­¥éª¤ï¼š

1. **åœ¨è®¾å¤‡ä¸Šå¯ç”¨å¼€å‘è€…é€‰é¡¹**ï¼š
   - æ‰“å¼€**è®¾ç½®** â†’ **å…³äºæ‰‹æœº**
   - è¿ç»­ç‚¹å‡»**ç‰ˆæœ¬å·** 7æ¬¡

2. **åˆ‡æ¢åˆ°ADBè°ƒè¯•æ¨¡å¼**ï¼š
   - è¿›å…¥**å¼€å‘è€…é€‰é¡¹**
   - æŸ¥æ‰¾ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼š
     - "USBè°ƒè¯•æ¨¡å¼é€‰æ‹©" â†’ é€‰æ‹© "ADBè°ƒè¯•"
     - "USBè°ƒè¯•" â†’ å¯ç”¨
     - "è°ƒè¯•æ¨¡å¼" â†’ é€‰æ‹© "Androidè°ƒè¯•"

3. **é‡æ–°è¿æ¥è®¾å¤‡**ï¼š
   ```bash
   # é‡å¯ADBæœåŠ¡
   adb kill-server
   adb start-server

   # æ£€æŸ¥è®¾å¤‡
   adb devices

   # éªŒè¯Flutterè¯†åˆ«
   flutter devices
   ```

4. **æˆæƒè°ƒè¯•**ï¼š
   - è®¾å¤‡ä¸Šä¼šå¼¹å‡º"å…è®¸USBè°ƒè¯•"æç¤º
   - å‹¾é€‰"å§‹ç»ˆå…è®¸"å¹¶ç‚¹å‡»"ç¡®å®š"

#### ä¼˜ç‚¹ï¼š
- âœ… Flutterå®Œå…¨æ”¯æŒ
- âœ… å¯ä»¥ä½¿ç”¨ `flutter run` ç›´æ¥è¿è¡Œ
- âœ… çƒ­é‡è½½åŠŸèƒ½å¯ç”¨
- âœ… è°ƒè¯•å·¥å…·å®Œæ•´æ”¯æŒ

#### æ³¨æ„äº‹é¡¹ï¼š
- æŸäº›æ–°å‹å·çš„é¸¿è’™è®¾å¤‡å¯èƒ½å·²å®Œå…¨ç§»é™¤ADBæ”¯æŒ
- å¦‚æœæ‰¾ä¸åˆ°ADBé€‰é¡¹ï¼Œè¯·ä½¿ç”¨æ–¹æ¡ˆBæˆ–C

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š`enable_adb_on_harmonyos.md`

### æ–¹æ¡ˆBï¼šä½¿ç”¨HDCæ‰‹åŠ¨éƒ¨ç½²ï¼ˆå½“å‰å¯ç”¨ï¼‰

å¦‚æœè®¾å¤‡ä¸æ”¯æŒADBæ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨HDCè¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²ã€‚

#### å¯ç”¨çš„HDCå‘½ä»¤ï¼š

```bash
# ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
source ~/.bashrc

# åˆ—å‡ºè®¾å¤‡
hdc list targets

# å®‰è£…åº”ç”¨
hdc install <app.hap>

# æ–‡ä»¶ä¼ è¾“
hdc file send <æœ¬åœ°æ–‡ä»¶> <è®¾å¤‡è·¯å¾„>
hdc file recv <è®¾å¤‡æ–‡ä»¶> <æœ¬åœ°è·¯å¾„>

# æŸ¥çœ‹æ—¥å¿—
hdc hilog

# æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯ï¼ˆå¯èƒ½å—é™ï¼‰
hdc target boot
```

#### Flutterå¼€å‘æµç¨‹ï¼š

1. **æ„å»ºåº”ç”¨**ï¼š
   ```bash
   flutter build apk
   ```

2. **ä½¿ç”¨HDCå®‰è£…**ï¼š
   ```bash
   hdc install build/app/outputs/flutter-apk/app-release.apk
   ```

3. **æ‰‹åŠ¨å¯åŠ¨åº”ç”¨å¹¶æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```bash
   hdc hilog | grep flutter
   ```

#### ä¼˜ç‚¹ï¼š
- âœ… ä¸éœ€è¦ä¿®æ”¹è®¾å¤‡è®¾ç½®
- âœ… é€‚åˆçº¯é¸¿è’™ç³»ç»Ÿ

#### ç¼ºç‚¹ï¼š
- âŒ æ— æ³•ä½¿ç”¨ `flutter run`
- âŒ æ²¡æœ‰çƒ­é‡è½½åŠŸèƒ½
- âŒ è°ƒè¯•ä½“éªŒè¾ƒå·®
- âŒ éœ€è¦æ‰‹åŠ¨é‡æ–°å®‰è£…æµ‹è¯•

### æ–¹æ¡ˆCï¼šä½¿ç”¨å…¶ä»–å¼€å‘ç¯å¢ƒ

å¦‚æœä¸Šè¿°æ–¹æ¡ˆéƒ½ä¸å¯è¡Œï¼š

1. **ä½¿ç”¨Windowsæˆ–Macç³»ç»Ÿ**ï¼š
   - DevEco Studioå®Œæ•´ç‰ˆä»…æ”¯æŒWindows/Mac
   - æä¾›æ›´å¥½çš„é¸¿è’™å¼€å‘æ”¯æŒ

2. **ä½¿ç”¨å…¶ä»–Androidè®¾å¤‡**ï¼š
   - ç”¨äºFlutterå¼€å‘å’Œæµ‹è¯•
   - æœ€ç»ˆåœ¨é¸¿è’™è®¾å¤‡ä¸ŠéªŒè¯

3. **ä½¿ç”¨Linuxæ¡Œé¢æ¨¡å¼**ï¼š
   ```bash
   flutter run -d linux
   ```
   - ç”¨äºå¼€å‘å’Œè°ƒè¯•
   - ä¸éœ€è¦ç‰©ç†è®¾å¤‡

## ğŸ”§ HDCå·¥å…·ä½¿ç”¨

### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹ç‰ˆæœ¬
hdc -v

# åˆ—å‡ºè®¾å¤‡
hdc list targets

# å®‰è£…åº”ç”¨
hdc install <app.hap>

# å¸è½½åº”ç”¨
hdc uninstall <åŒ…å>

# æ¨é€æ–‡ä»¶
hdc file send <æœ¬åœ°æ–‡ä»¶> <è®¾å¤‡è·¯å¾„>

# æ‹‰å–æ–‡ä»¶
hdc file recv <è®¾å¤‡æ–‡ä»¶> <æœ¬åœ°è·¯å¾„>

# æŸ¥çœ‹æ—¥å¿—
hdc hilog

# ç«¯å£è½¬å‘
hdc fport tcp:<æœ¬åœ°ç«¯å£> tcp:<è®¾å¤‡ç«¯å£>
```

### ç¯å¢ƒå˜é‡é…ç½®

HDCå·¥å…·å·²æ·»åŠ åˆ°PATHï¼Œåœ¨æ–°ç»ˆç«¯ä¸­ç”Ÿæ•ˆï¼š

```bash
# ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
source ~/.bashrc

# æˆ–è€…é‡æ–°æ‰“å¼€ç»ˆç«¯
```

å¦‚æœéœ€è¦ä¸´æ—¶ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ï¼š

```bash
# ä½¿ç”¨OpenHarmonyç‰ˆæœ¬
export PATH="$HOME/harmonyos-tools/hwsdk/openharmony/9/toolchains:$PATH"

# ä½¿ç”¨HarmonyOSç‰ˆæœ¬
export PATH="$HOME/harmonyos-tools/hwsdk/hmscore/3.1.0/toolchains:$PATH"
```

## ğŸ› å…³äº"bad state no element"é”™è¯¯

è¿™ä¸ªé”™è¯¯å¾ˆå¯èƒ½æ¥è‡ªæ‚¨çš„Flutteråº”ç”¨ä¸­çš„è“ç‰™åŠŸèƒ½ï¼ˆ`lib/data/datasources/bluetooth_datasource.dart`ï¼‰ã€‚

### å¯èƒ½çš„åŸå› ï¼š

åœ¨ä»¥ä¸‹ä½ç½®ä½¿ç”¨äº† `.first` æ“ä½œï¼Œå½“Streamä¸ºç©ºæ—¶ä¼šæŠ›å‡ºæ­¤é”™è¯¯ï¼š

- `bluetooth_datasource.dart:68` - `FlutterBluePlus.adapterState.first`
- `bluetooth_datasource.dart:75` - `FlutterBluePlus.isScanning.first`
- `bluetooth_datasource.dart:158` - `FlutterBluePlus.adapterState.first`

### è°ƒè¯•å»ºè®®ï¼š

1. **åœ¨Linuxæ¡Œé¢ä¸Šè¿è¡Œåº”ç”¨**ï¼š
   ```bash
   flutter run -d linux
   ```
   è¿™æ ·å¯ä»¥çœ‹åˆ°å®Œæ•´çš„é”™è¯¯å †æ ˆä¿¡æ¯

2. **æ£€æŸ¥è“ç‰™æƒé™**ï¼š
   ç¡®ä¿åº”ç”¨æœ‰è“ç‰™æƒé™

3. **æ·»åŠ é”™è¯¯å¤„ç†**ï¼š
   ä½¿ç”¨ `.firstOrNull` æˆ–æ·»åŠ  try-catch

å¦‚æœéœ€è¦å¸®åŠ©ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼Œè¯·æä¾›å®Œæ•´çš„é”™è¯¯å †æ ˆä¿¡æ¯ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `HDC_USAGE_GUIDE.md` - HDCå·¥å…·è¯¦ç»†ä½¿ç”¨æŒ‡å—
- `enable_adb_on_harmonyos.md` - ADBæ¨¡å¼å¯ç”¨æ­¥éª¤
- `install_hdc.sh` - HDCè‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬

## ğŸ”— å‚è€ƒèµ„æº

- [åä¸ºå¼€å‘è€…æ–‡æ¡£ - HDCå·¥å…·](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc)
- [OpenHarmony HDCæ–‡æ¡£](https://gitee.com/openharmony/developtools_hdc_standard)
- [DevEco Studioä¸‹è½½](https://developer.huawei.com/consumer/cn/deveco-studio/)
- [HarmonyOS Next HDC Issue (Solved)](https://xdaforums.com/t/harmonyos-next-hdc-issue-solved.4704329/)

## ğŸ’¡ æ¨èçš„ä¸‹ä¸€æ­¥

1. **é¦–é€‰**ï¼šå°è¯•åœ¨è®¾å¤‡ä¸Šå¯ç”¨ADBæ¨¡å¼
   - å‚è€ƒ `enable_adb_on_harmonyos.md`
   - è¿™å°†æä¾›æœ€ä½³çš„Flutterå¼€å‘ä½“éªŒ

2. **å¤‡é€‰**ï¼šä½¿ç”¨HDCè¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²
   - å‚è€ƒ `HDC_USAGE_GUIDE.md`
   - é€‚åˆçº¯é¸¿è’™ç³»ç»Ÿ

3. **è°ƒè¯•**ï¼šä¿®å¤"bad state no element"é”™è¯¯
   - åœ¨Linuxæ¡Œé¢ä¸Šè¿è¡Œåº”ç”¨æŸ¥çœ‹è¯¦ç»†é”™è¯¯
   - æˆ–æä¾›é”™è¯¯å †æ ˆä¿¡æ¯ä»¥è·å¾—å¸®åŠ©

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆHDCæ˜¾ç¤º"ç‰ˆæœ¬è¿‡ä½"ï¼Ÿ

**A:** è¿™æ˜¯å› ä¸ºæ‚¨çš„è®¾å¤‡è¿è¡ŒHarmonyOS NEXTï¼ˆ5.0+ï¼‰ï¼Œè®¾å¤‡ä¸Šçš„HDCæœåŠ¡ç‰ˆæœ¬æ¯”SDKä¸­çš„HDCå®¢æˆ·ç«¯ç‰ˆæœ¬æ›´æ–°ã€‚è¿™ä¸å½±å“å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œåªæ˜¯shellè®¿é—®å—é™ã€‚

### Q2: å¦‚ä½•æ›´æ–°HDCåˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ

**A:**
```bash
cd ~/harmonyos-tools/command-line-tools/bin
./sdkmgr list toolchains
./sdkmgr install OpenHarmony/toolchains:9 --accept-license
```

### Q3: Flutterä¸ºä»€ä¹ˆä¸æ”¯æŒHDCï¼Ÿ

**A:** Flutteræ˜¯ä¸ºAndroid/iOSè®¾è®¡çš„ï¼Œä¾èµ–ADBåè®®ã€‚HDCæ˜¯é¸¿è’™ä¸“ç”¨åè®®ã€‚è¦ä½¿ç”¨Flutterï¼Œéœ€è¦è®¾å¤‡æ”¯æŒADBæ¨¡å¼ã€‚

### Q4: è®¾å¤‡æ‰¾ä¸åˆ°ADBé€‰é¡¹æ€ä¹ˆåŠï¼Ÿ

**A:** æŸäº›æ–°å‹å·çš„çº¯é¸¿è’™è®¾å¤‡å·²å®Œå…¨ç§»é™¤ADBæ”¯æŒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ï¼š
- ä½¿ç”¨HDCæ‰‹åŠ¨éƒ¨ç½²
- æˆ–ä½¿ç”¨Windows/Macç³»ç»Ÿå¼€å‘
- æˆ–ä½¿ç”¨å…¶ä»–Androidè®¾å¤‡æµ‹è¯•

### Q5: å¦‚ä½•å¸è½½HDCå·¥å…·ï¼Ÿ

**A:**
```bash
# åˆ é™¤å·¥å…·ç›®å½•
rm -rf ~/harmonyos-tools

# ä».bashrcä¸­åˆ é™¤ç¯å¢ƒå˜é‡é…ç½®
nano ~/.bashrc
# åˆ é™¤åŒ…å«"HarmonyOS HDCå·¥å…·"çš„è¡Œ

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£ï¼ˆHDC_USAGE_GUIDE.mdç­‰ï¼‰
3. è®¿é—®åä¸ºå¼€å‘è€…è®ºå›
4. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ä»¥è·å¾—æ›´å¥½çš„å¸®åŠ©

---

**æœ€åæ›´æ–°**: 2026-01-23
**HDCç‰ˆæœ¬**: 1.2.0a
**è®¾å¤‡ID**: 33Z0224620027607
